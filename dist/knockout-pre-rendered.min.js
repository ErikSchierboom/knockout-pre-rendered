(function(root,factory){if(typeof define==="function"&&define.amd){define(["knockout"],factory)}else if(typeof exports==="object"){module.exports=factory(require("knockout"))}else{root.KnockoutElse=factory(root.ko)}})(this,function(ko){"use strict";function isPlainObject(o){return!!o&&typeof o==="object"&&o.constructor===Object}var commentNodesHaveTextProperty=window.document&&window.document.createComment("test").text==="\x3c!--test--\x3e";var startCommentRegex=commentNodesHaveTextProperty?/^<!--\s*ko(?:\s+([\s\S]+))?\s*-->$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/;function isVirtualNode(node){return node.nodeType==8&&startCommentRegex.test(commentNodesHaveTextProperty?node.text:node.nodeValue)}function isElementNode(node){return node&&node.nodeType&&node.nodeType===1}function isValidChildNode(attribute,childNode){if(typeof attribute==="string"){return isElementNode(childNode)&&childNode.attributes&&childNode.attributes[attribute]}return isElementNode(childNode)}function findFirstChild(parentNode,attribute){return ko.utils.arrayFirst(ko.virtualElements.childNodes(parentNode),isValidChildNode.bind(this,attribute))}function findChildren(parentNode,attribute){return ko.utils.arrayFilter(ko.virtualElements.childNodes(parentNode),isValidChildNode.bind(this,attribute))}function makeTemplateNode(sourceNode,namedTemplate,deleteTemplateNodes,nodesPerElement){var container=document.createElement("div");var parentNode;var namedTemplate;if(sourceNode.content){parentNode=sourceNode.content}else if(sourceNode.tagName==="SCRIPT"){if(sourceNode.innerHTML.match(/^\s*<tr[\s\S]*?<\/tr>\s*$/i)){var tbl=document.createElement("table");tbl.innerHTML="<tbody>"+sourceNode.innerHTML+"</tbody>";parentNode=tbl.firstChild}else{parentNode=document.createElement("div");parentNode.innerHTML=sourceNode.innerHTML}}else{parentNode=sourceNode}var template=findFirstChild(parentNode,namedTemplate?null:"data-template");for(var i=0,node=template;i<nodesPerElement;i++){var currentNode=node;container.insertBefore(node.cloneNode(true),null);do{node=node.nextElementSibling||node.nextSibling}while(node&&node.nodeType!==1);if(deleteTemplateNodes){ko.removeNode(currentNode)}}return container}function valueToChangeAddExistingItem(value,index){return{status:"existing",value:value,index:index}}ko.utils.extend(ko.expressionRewriting._twoWayBindings,{text:true,html:true,visible:true,enable:true,disable:true});generatePropertyWritersForBinding("attr","_ko_prerender_attrPropertyWriters","attr");generatePropertyWritersForBinding("css","_ko_prerender_cssPropertyWriters","css");function generatePropertyWritersForBinding(bindingName,propertyWritersBindingName,defaultWriterName,mapExpressionsCallback){var existingPreprocessor=ko.bindingHandlers[bindingName].preprocess;ko.bindingHandlers[bindingName].preprocess=function(value,name,addBinding){if(existingPreprocessor){value=existingPreprocessor(value,name,addBinding)}var expressions=ko.expressionRewriting.parseObjectLiteral(value);if(mapExpressionsCallback){expressions=ko.utils.arrayMap(expressions,mapExpressionsCallback)}var writers=[];ko.utils.arrayForEach(expressions,function(expression){if(expression!=null){var writableExpression=getWritableValue("unknown"in expression?expression["unknown"]:expression.value);if(writableExpression){writers.push("'"+("unknown"in expression?defaultWriterName:expression.key)+"':function(_v){"+writableExpression+"=_v}")}}});if(writers.length!=0){addBinding(propertyWritersBindingName,"{"+writers.join(",")+"}")}return value||true}}var javaScriptReservedWords=["true","false","null","undefined"];var javaScriptAssignmentTarget=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;function getWritableValue(expression){if(ko.utils.arrayIndexOf(javaScriptReservedWords,expression)==-1){var match=expression.match(javaScriptAssignmentTarget);return match===null?false:match[1]?"Object("+match[1]+")"+match[2]:expression}return false}function InitializedForeach(element,valueAccessor,bindings,viewModel,context){var self=this;this.element=element;this.container=isVirtualNode(element)?this.element.parentNode:element;this.$context=context;var useRawData=false;var spec=valueAccessor();if(!isPlainObject(spec)){useRawData=ko.unwrap(context.$rawData)===spec;spec={data:useRawData?context.$rawData:spec,createElement:spec.createElement}}this.data=spec.data;this.as=spec.as;this.createElement=spec.createElement;this.noContext=spec.noContext;this.namedTemplate=spec.name!==undefined;this.nodesPerElement=spec.nodesPerElement||1;this.templateNode=makeTemplateNode(spec.name?document.getElementById(spec.name):element,this.namedTemplate,!spec.name,this.nodesPerElement);this.afterQueueFlush=spec.afterQueueFlush;this.beforeQueueFlush=spec.beforeQueueFlush;this.dataChanged=spec.dataChanged;this.changeQueue=[];this.lastNodesList=[];this.childContexts=[];this.indexesToDelete=[];this.rendering_queued=false;this.existingElements=findChildren(this.namedTemplate?this.element:this.container,this.namedTemplate?null:"data-init");if(typeof this.createElement==="function"){this.createElements()}var primeData=ko.unwrap(this.data);this.onArrayChange(ko.utils.arrayMap(primeData,valueToChangeAddExistingItem));if(ko.isObservable(this.data)){if(!this.data.indexOf){this.data=this.data.extend({trackArrayChanges:true})}this.changeSubs=this.data.subscribe(this.onArrayChange,this,"arrayChange")}else{this.changeSubs=ko.computed(function(){var value=useRawData?context.$rawData:valueAccessor();var newContents=ko.unwrap(isPlainObject(value)?value.data:value);if(this.previousContents!=null){var diff=ko.utils.compareArrays(this.previousContents,newContents,{sparse:true});if(diff.length!=0){self.onArrayChange(diff)}}this.previousContents=[].concat(newContents)},{previousContents:null})}}InitializedForeach.animateFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(cb){return window.setTimeout(cb,1e3/60)};InitializedForeach.prototype.dispose=function(){if(this.changeSubs){this.changeSubs.dispose()}};InitializedForeach.prototype.onArrayChange=function(changeSet){var self=this;var changeMap={added:[],existing:[],deleted:[]};ko.utils.arrayForEach(changeSet,function(changeItem){changeMap[changeItem.status].push(changeItem)});if(typeof this.dataChanged==="function"){this.dataChanged(changeMap)}if(changeMap.deleted.length>0){this.changeQueue.push.apply(this.changeQueue,changeMap.deleted);this.changeQueue.push({status:"clearDeletedIndexes"})}this.changeQueue.push.apply(this.changeQueue,changeMap.existing);this.changeQueue.push.apply(this.changeQueue,changeMap.added);if(this.changeQueue.length>0&&!this.rendering_queued){this.rendering_queued=true;InitializedForeach.animateFrame.call(window,function(){self.processQueue()})}};InitializedForeach.prototype.processQueue=function(){var self=this;if(typeof this.beforeQueueFlush==="function"){this.beforeQueueFlush(this.changeQueue)}ko.utils.arrayForEach(this.changeQueue,function(changeItem){self[changeItem.status](changeItem.index,changeItem.value)});this.rendering_queued=false;if(typeof this.afterQueueFlush==="function"){this.afterQueueFlush(this.changeQueue)}this.changeQueue=[]};InitializedForeach.prototype.createChildContext=function(index,value){if(this.noContext){return this.$context.extend({$item:value})}return this.$context.createChildContext(value,this.as||null,function(context){context["$index"]=ko.observable(index)})};InitializedForeach.prototype.existing=function(index,value){var context=this.childContexts[index]=this.createChildContext(index,value);var elementIndex=index*this.nodesPerElement;var existingElement;for(var i=0;i<this.nodesPerElement;i++){existingElement=this.existingElements[elementIndex+i];ko.applyBindings(context,existingElement)}this.lastNodesList.splice(index,0,existingElement)};InitializedForeach.prototype.added=function(index,value){var referenceElement=this.lastNodesList[index-1]||null;var templateClone=this.templateNode.cloneNode(true);var childNodes=ko.virtualElements.childNodes(templateClone);this.lastNodesList.splice(index,0,childNodes[childNodes.length-1]);this.childContexts[index]=this.createChildContext(index,value);ko.applyBindingsToDescendants(this.childContexts[index],templateClone);for(var i=childNodes.length-1;i>=0;--i){var child=childNodes[i];if(!child)return;ko.virtualElements.insertAfter(this.element,child,referenceElement)}};InitializedForeach.prototype.deleted=function(index,value){var ptr=this.lastNodesList[index],lastNode=this.lastNodesList[index-1]||this.element;do{ptr=ptr.previousSibling;ko.removeNode(ptr&&ptr.nextSibling||ko.virtualElements.firstChild(this.element))}while(ptr&&ptr!==lastNode);this.lastNodesList[index]=this.lastNodesList[index-1];this.indexesToDelete.push(index)};InitializedForeach.prototype.clearDeletedIndexes=function(){for(var i=this.indexesToDelete.length-1;i>=0;--i){this.lastNodesList.splice(this.indexesToDelete[i],1);this.childContexts.splice(this.indexesToDelete[i],1)}for(var j=this.childContexts.length-1;j>=0;--j){if(this.childContexts[j]&&this.childContexts[j]["$index"]){this.childContexts[j]["$index"](j)}}this.indexesToDelete=[]};InitializedForeach.prototype.createElements=function(){var self=this;var elements=[];for(var i=0;i<this.existingElements.length/this.nodesPerElement;i++){elements.push(this.createElement())}if(ko.isObservable(this.data)){this.data(elements)}else{ko.utils.arrayForEach(elements,function(element){self.data.push(element)})}};ko.bindingHandlers.foreachInit={init:function init(element,valueAccessor,bindings,viewModel,context){var initializedForeach=new InitializedForeach(element,valueAccessor,bindings,viewModel,context);ko.utils.domNodeDisposal.addDisposeCallback(element,function(){initializedForeach.dispose()});return{controlsDescendantBindings:true}},InitializedForeach:InitializedForeach};ko.virtualElements.allowedBindings.foreachInit=true;function elementIsHidden(element){return element.offsetWidth<=0&&element.offsetHeight<=0||element.style&&element.style.display&&element.style.display=="none"}function isObjectWithExplicitValues(value){return isPlainObject(value)&&value["value"]===undefined&&value["convert"]===undefined&&value["field"]===undefined}function setExplicitObjectValues(value,viewModel,allBindings){var propertyWriters=allBindings.get("_ko_prerender_initPropertyWriters");for(var key in value){if(value.hasOwnProperty(key)&&viewModel[key]instanceof Function){viewModel[key](value[key])}else if(propertyWriters){var writer=propertyWriters[key];if(writer){writer(value[key])}}}}extendBindingInit("value");extendBindingInit("text");extendBindingInit("textInput");extendBindingInit("checked",function(element){return element.checked});extendBindingInit("visible",function(element){return!elementIsHidden(element)});extendBindingInit("html",function(element){return element.innerHTML});extendBindingInit("enable",function(element){return!element.disabled});extendBindingInit("disable",function(element){return element.disabled});extendBindingInit("attr",function(element,name){return element.attributes[name]?element.attributes[name].value:undefined},true,"_ko_prerender_attrPropertyWriters");extendBindingInit("css",function(element,name){return new RegExp("\\b"+name+"\\b","i").test(element.className)},true,"_ko_prerender_cssPropertyWriters");function defaultMarkupReader(element){return element.innerText||element.textContent||element.value}function extendBindingInit(bindingName,markupReader,isMultiValue,propertyWritersBindingName){markupReader=markupReader||defaultMarkupReader;propertyWritersBindingName=propertyWritersBindingName||(ko.expressionRewriting._twoWayBindings[bindingName]?"_ko_property_writers":undefined);var bindingHandler=ko.bindingHandlers[bindingName];var existingInit=bindingHandler.init;bindingHandler.init=function(element,valueAccessor,allBindings,viewModel){var initBinding=allBindings.get("init");if(initBinding){var convert=initBinding["convert"];if(!isMultiValue){var valueFromMarkup=markupReader(element);if(hasFieldOverride(initBinding)&&!initBinding.hasOwnProperty("value")){writeValueToModel(valueFromMarkup,initBinding.hasOwnProperty("field")?initBinding["field"]:initBinding,convert,"field",allBindings,"_ko_prerender_initPropertyWriters")}else{writeValueToModel(valueFromMarkup,valueAccessor(),convert,bindingName,allBindings,propertyWritersBindingName)}}else{var props=valueAccessor();for(var key in props){var valueFromMarkup=markupReader(element,key);writeValueToModel(valueFromMarkup,props[key],convert,key,allBindings,propertyWritersBindingName)}}}if(existingInit){existingInit.apply(this,arguments)}}}function writeValueToModel(value,fieldAccessor,convert,key,allBindings,propertyWritersBindingName){if(convert){var conversion=convert.hasOwnProperty(key)?convert[key]:convert;if(conversion instanceof Function){value=conversion(value)}}if(ko.isObservable(fieldAccessor)){fieldAccessor(value,ko.unwrap(fieldAccessor))}else{var propertyWriter=getPropertyWriter(allBindings,propertyWritersBindingName,key);if(propertyWriter){propertyWriter(value)}}}function getPropertyWriter(allBindings,propertyWritersBindingName,key){if(propertyWritersBindingName){var propertyWriters=allBindings.get(propertyWritersBindingName);if(propertyWriters){return propertyWriters[key]}}return null}function hasFieldOverride(initBinding){if(isPlainObject(initBinding)){return initBinding.hasOwnProperty("field")}return initBinding!==true}ko.bindingHandlers.init={init:function(element,valueAccessor,allBindings,viewModel){var initBinding=valueAccessor();if(initBinding===true){return}if(isObjectWithExplicitValues(initBinding)){setExplicitObjectValues(initBinding,viewModel,allBindings)}var valueElement=isVirtualNode(element)?ko.virtualElements.firstChild(element):element;var value=initBinding.hasOwnProperty("value")?initBinding["value"]:defaultMarkupReader(valueElement);writeValueToModel(value,initBinding.hasOwnProperty("field")?initBinding["field"]:initBinding,initBinding["convert"],"field",allBindings,"_ko_prerender_initPropertyWriters")}};generatePropertyWritersForBinding("init","_ko_prerender_initPropertyWriters","field",function(expression){var key=expression.key;return key==="convert"||key==="value"?null:key===undefined||key==="field"?expression:{key:key,value:key}});ko.virtualElements.allowedBindings.init=true});